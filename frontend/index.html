<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dustbin Management System</title>
<link rel="stylesheet" href="styles.css">
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
</head>
<body>
<div class="container">
  <h2>Dustbin Management System</h2>
  <form id="dustbinForm">
    <div class="form-group">
      <label for="latitude">Latitude:</label>
      <input type="text" id="latitude" name="latitude" required>
    </div>
    <div class="form-group">
      <label for="longitude">Longitude:</label>
      <input type="text" id="longitude" name="longitude" required>
    </div>
    <div class="form-group">
      <label for="capacity">Capacity:</label>
      <input type="text" id="capacity" name="capacity" required>
    </div>
    <button type="submit">Add Dustbin</button>
  </form>
  <h2>Available Dustbins</h2>
  <div id="dustbinsContainer" style="margin-top: 20px;">
  </div>
  <h2>Optimized Route</h2>
  <div id="optimizedRouteContainer" style="margin-top: 20px;">
    <button id="calculateRouteButton">Calculate Optimized Route</button>
    <!-- EXTRA START -->
    <!-- <input type="number" id="numVehicles" placeholder="Enter number of vehicles" min="1" />
    <button id="calculateRouteButton">Calculate Routes</button> -->
    <!-- EXTRA END -->
    <p id="optimizedRouteSequence"></p>
  </div>
  <h2>Locations</h2>
  <!-- <div class="geomapContainer" style="margin-top: 20px;">
    <div id="map"></div>
  </div> -->
  <div id="mapContainer" style="margin-top: 20px;">
    <!-- The map will load here -->
</div>
</div>
<script src="scripts.js"></script>


<script>
document.getElementById("calculateRouteButton").addEventListener("click", async () => {
    try {
        // Fetch the updated dustbins from the backend
        const dustbinResponse = await fetch("http://127.0.0.1:5000/dustbins");
        if (!dustbinResponse.ok) {
            throw new Error("Failed to fetch dustbins.");
        }

        const dustbinData = await dustbinResponse.json();
        const dustbins = dustbinData.dustbins;

        // Send the dustbins data to the backend to calculate the optimized route
        const response = await fetch("http://127.0.0.1:5000/plan_optimized_route", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ dustbins }),
        });

        if (response.ok) {
            // Step 1: Clear the previous iframe content (if any)
            const mapContainer = document.getElementById("mapContainer");
            mapContainer.innerHTML = '';

            // Step 2: Dynamically update the iframe to show the new map
            mapContainer.innerHTML = `<iframe src="http://127.0.0.1:5501/backend/route_map.html" 
                                        style="width: 100%; height: 400px; border: none;"></iframe>`;
        } else {
            throw new Error("Failed to calculate the optimized route.");
        }
    } catch (error) {
        console.error("An error occurred:", error.message);
        alert("An error occurred: " + error.message);
    }
});
</script>

</body>
</html>
